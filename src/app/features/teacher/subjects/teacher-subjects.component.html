<section class="teacher-subjects">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Mis Materias Asignadas</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if(assignedSubjects.length > 0){
      <div class="assigned-subjects">
        @for(assignment of assignedSubjects; track $index){
        <app-card
          [cardTitle]="
            assignment.mid_comission_subject?.subject?.subject_name ||
            'Sin nombre'
          "
          [cardSubtitle]="
            'Comisión: ' +
            (assignment.mid_comission_subject?.comission?.comission_name ||
              'N/A') +
            ' - Año: ' +
            (assignment.mid_comission_subject?.comission?.comission_year ||
              'N/A')
          "
          [cardPercentageLabel]="'Año de la materia'"
          [cardPercentage]="
            assignment.mid_comission_subject?.subject?.subject_year || 0
          "
          [cardDateLabel]="'Tipo de asignación'"
          [cardDate]="assignment.assign_type || 'DICTA'"
        >
        </app-card>
        }
      </div>
      } @else {
      <div class="empty-state">
        <mat-icon>school</mat-icon>
        <p>Aún no tienes materias asignadas.</p>
        <p>Utiliza el formulario de la derecha para asignarte a materias.</p>
      </div>
      }
    </mat-card-content>
  </mat-card>

  <aside>
    <mat-card>
      <mat-card-header>
        <mat-card-title>Asignación a Materias</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <div class="assignment-form">
          <mat-form-field appearance="outline">
            <mat-label>Selecciona la carrera</mat-label>
            <mat-select
              [(value)]="selectedDegree"
              (selectionChange)="onDegreeChange($event.value)"
            >
              <mat-option *ngFor="let degree of degrees" [value]="degree.id">
                {{ degree.degree_name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="selectedDegree">
            <mat-label>Selecciona la comisión</mat-label>
            <mat-select
              [(value)]="selectedComission"
              (selectionChange)="onComissionChange($event.value)"
            >
              @for(comission of comissions; track $index){
              <mat-option [value]="comission.id">
                Comisión {{ comission.comission_name }} -
                {{ comission.comission_year }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if(selectedComission && availableSubjects.length > 0){
          <div class="subjects-list">
            <h3>Materias disponibles:</h3>
            <mat-list>
              @for(midComSubject of availableSubjects; track $index){
              <mat-list-item>
                <div matListItemTitle>
                  {{ midComSubject.subject.subject_name }}
                </div>
                <div matListItemLine>
                  Año: {{ midComSubject.subject.subject_year }}
                </div>
                <button
                  matButton="tonal"
                  (click)="assignSubject(midComSubject.id)"
                  [disabled]="isAssigned(midComSubject.id)"
                >
                  {{ isAssigned(midComSubject.id) ? "Asignado" : "Asignarme" }}
                </button>
              </mat-list-item>
              }
            </mat-list>
          </div>
          } @else if(selectedComission && availableSubjects.length === 0){
          <p class="no-subjects">
            No hay materias disponibles en esta comisión.
          </p>
          } @else if(!selectedDegree) {
          <p class="hint">Selecciona una carrera para comenzar.</p>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Información</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <mat-list>
          <mat-list-item>
            <span matListItemTitle>Carrera seleccionada:</span>
            <span matListItemLine>{{
              getDegreeName(selectedDegree) || "Ninguna"
            }}</span>
          </mat-list-item>

          <mat-list-item>
            <span matListItemTitle>Comisión:</span>
            <span matListItemLine>{{
              getComissionName(selectedComission) || "Ninguna"
            }}</span>
          </mat-list-item>

          <mat-list-item>
            <span matListItemTitle>Materias asignadas:</span>
            <span matListItemLine>{{ assignedSubjects.length }}</span>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Tabla de Referencias</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <mat-list>
          <mat-list-item>
            <mat-icon matListItemIcon>school</mat-icon>
            <div matListItemTitle>DICTA</div>
            <div matListItemLine>Profesor titular de la materia</div>
          </mat-list-item>

          <mat-list-item>
            <mat-icon matListItemIcon>assignment_ind</mat-icon>
            <div matListItemTitle>PRECEPTOR</div>
            <div matListItemLine>Preceptor asignado</div>
          </mat-list-item>

          <mat-list-item>
            <mat-icon matListItemIcon>person</mat-icon>
            <div matListItemTitle>CURSA</div>
            <div matListItemLine>Estudiante que cursa</div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </aside>
</section>
